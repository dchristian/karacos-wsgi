<% user_auth = instance.__domain__.get_user_auth() %>
<% isstaff = 'anonymous@%s' % instance.__domain__['name'] != user_auth['name'] %>

% if isstaff:
<script language="javascript">
	$(function(){ 
	GENTICS.Aloha.settings = {
	   'i18n' : {
	     'current' : 'fr'
	   },
	   'base' : GENTICS_Aloha_base,
	   'ribbon' : true,
	   'plugins': {
				   "com.gentics.aloha.plugins.DragAndDropFiles": {
	   					config : { 'drop' : {'max_file_size': '200000',
	   										 'max_file_count': 2,
	   										 'upload': {'url': "",
	   										 			'file_name_param':"",
	   										 			'additional_params': {"location":""},
				   										'www-encoded': false }}},
					  	editables : {
							'#resource_title'	: [  ]
					  	},
	   				},
	   				"com.gentics.aloha.plugins.Image": {
	   					config : { 'img': { 'max_width': '50px',
	   										'max_height': '50px' }},
					  	editables : {
							'#resource_title'	: [  ]
					  	},
	   				},
	   				"org.karacos.aloha.Plugin": { 
	   				instance_url : "${instance._get_action_url()}",
	   				edit_content_action : "edit_content",
	   				idfieldsref : {
							resource_title	: "title",
							resource_content 	: "content"
					  	}},
					"com.gentics.aloha.plugins.Link": {
								config : [ 'a' ],
							  	editables : {
								'#resource_title'	: [  ]
							  	},
							  	targetregex : '^(?!.*${instance.__domain__['fqdn']}).*',
							  	target : '_blank',
							  	},
					"com.gentics.aloha.plugins.List": {
						editables : {
								'#resource_title'	: [  ]
							  	}
					},
					"com.gentics.aloha.plugins.Table": {
						editables : {
								'#resource_title'	: [  ]
							  	}
					},
		   			"com.gentics.aloha.plugins.Format": { 
						config : [ 'b', 'i','u','del','sub','sup', 'p', 'title', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'pre', 'removeFormat'],
					  	editables : {
							'#resource_title'	: [ ], // no formatting allowed
							'#resource_content' 	: [ 'b', 'i', 'u', 'del', 'sub', 'sup','removeFormat'  ] // just basic formattings, no headers, etc.
					  	}
					} // plugin
				} // plugins
				
		}; //Aloha.Settings
		 % if isstaff:
			$("#resource_title").aloha();
			$("#resource_content").aloha();
		% endif

});

	</script>
% endif
<%def name="show_field(field)">
	<tr><td>${field['title']}</td>
	<% type = "" %>
		% if 'formType' in field:
			<% type = field['formType'] %>
		% else:
			<% type = field['dataType'] %>
		% endif
		<td><input type="${type}" name="${field['name']}"></td></tr>
</%def>

<%def name="show_form(action,form,acturl)">
	% if 'fields' in form:
	<form method='POST' action='${acturl}'>
	<input type='hidden' name='method' value='${action}'/>
	<table>
		% for field in form['fields']:
		
		${show_field(field)}
		% endfor
	% endif
	<tr><td colspan='2'><input type='submit' value='${action}'/></td></tr>
	</table>
	</form>
</%def>
	<h1 id="resource_title">
	% if 'title' in instance:
		${instance['title']}
	% else:
		Noeud ${instance['name']} du domaine ${instance.__domain__['name']}
	% endif
	</h1>
	
	% if result:
		${result}
	% endif
	% if 'apps' in instance:
		<ul>
		% for app in instance['apps']:
			<li><a href="${app}">${app}</a></li>
		% endfor
		</ul>
	% endif
	<div id="resource_content">
	% if 'content' in instance:
		${instance['content']}
	% else:
		<p>No content found</p>
	% endif
	</div>
	<ul>
	<% childrens = instance.get_web_childrens_for_id() %>
	% for child in childrens.keys():
	<% acturl = "/%s/" % instance.get_relative_uri() %>
		<li><a href="${acturl}${childrens[child]}">${child}</a></li>
	% endfor
	</ul>
	
	
